env:
  DB_HOSTNAME:
    valueFrom:
      secretKeyRef:
        name: postgres-immich-app
        key: host
  DB_DATABASE_NAME:
    valueFrom:
      secretKeyRef:
        name: postgres-immich-app
        key: dbname
  DB_USERNAME:
    valueFrom:
      secretKeyRef:
        name: postgres-immich-app
        key: username
  DB_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: postgres-immich-app
        key: password

immich:
  persistence:
    library:
      existingClaim: immich-upload

valkey:
  enabled: true
  persistence:
    data:
      enabled: true
      size: 256Mi
      type: pvc
      storageClass: longhorn

server:
  image:
    repository: ghcr.io/immich-app/immich-server # needed here for renovate to pick up this file
    tag: v2.0.0@sha256:d81f4af6a622d0955e5b8e3927da32b3ec882466a7ee8a26906d9cccad4364ca
  resources:
    requests:
      cpu: 250m
    limits:
      cpu: 1250m
      gpu.intel.com/i915: 1
  persistence:
    external:
      enabled: true
      existingClaim: immich-external
      readOnly: true
  ingress:
    main:
      enabled: true
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt
      tls:
        - hosts:
            - immich.hs.liquid.sh
          secretName: tls-immich-ingress
      hosts:
        - host: immich.hs.liquid.sh
          paths:
            - path: /

machine-learning:
  image:
    repository: ghcr.io/immich-app/immich-machine-learning # needed here for renovate to pick up this file
    tag: v2.0.1@sha256:45626a33361ef7ed361de41b0d2dc19e5949442cdf0a8eb64b157dc8a04e9855
  resources:
    requests:
      cpu: 250m
    limits:
      cpu: 1000m
  persistence:
    cache:
      type: pvc
      storageClass: nfs-csi
    config:
      type: emptyDir
      mountPath: /.config
    tempCache:
      type: emptyDir
      mountPath: /.cache
    tmp:
      enabled: true
      type: emptyDir

securityContext:
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true
  capabilities:
    drop:
    - ALL

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 1000
  fsGroup: 1000
  fsGroupChangePolicy: OnRootMismatch
  seccompProfile:
    type: RuntimeDefault
